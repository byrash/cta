{"ast":null,"code":"import { render } from 'preact';\nimport fileDrop from 'file-drops';\nimport mitt from 'mitt';\nimport { useEffect, useRef, useState, useCallback } from 'preact/hooks';\nimport { isFunction } from 'min-dash';\nimport download from 'downloadjs';\nimport classNames from 'classnames';\nimport { Form, getSchemaVariables } from '@bpmn-io/form-js-viewer';\nimport { FormEditor } from '@bpmn-io/form-js-editor';\nimport { jsxs, jsx } from 'preact/jsx-runtime';\nimport { basicSetup } from 'codemirror';\nimport { EditorView, keymap, placeholder } from '@codemirror/view';\nimport { Facet, Compartment, EditorState } from '@codemirror/state';\nimport { linter, lintGutter } from '@codemirror/lint';\nimport { json, jsonParseLinter } from '@codemirror/lang-json';\nimport { indentWithTab } from '@codemirror/commands';\nimport { autocompletion } from '@codemirror/autocomplete';\nimport { syntaxTree } from '@codemirror/language';\nimport { classes } from 'min-dom';\nfunction Modal(props) {\n  useEffect(() => {\n    function handleKey(event) {\n      if (event.key === 'Escape') {\n        event.stopPropagation();\n        props.onClose();\n      }\n    }\n    document.addEventListener('keydown', handleKey);\n    return () => {\n      document.removeEventListener('keydown', handleKey);\n    };\n  });\n  return jsxs(\"div\", {\n    class: \"fjs-pgl-modal\",\n    children: [jsx(\"div\", {\n      class: \"fjs-pgl-modal-backdrop\",\n      onClick: props.onClose\n    }), jsxs(\"div\", {\n      class: \"fjs-pgl-modal-content\",\n      children: [jsx(\"h1\", {\n        class: \"fjs-pgl-modal-header\",\n        children: props.name\n      }), jsx(\"div\", {\n        class: \"fjs-pgl-modal-body\",\n        children: props.children\n      }), jsx(\"div\", {\n        class: \"fjs-pgl-modal-footer\",\n        children: jsx(\"button\", {\n          type: \"button\",\n          class: \"fjs-pgl-button fjs-pgl-button-default\",\n          onClick: props.onClose,\n          children: \"Close\"\n        })\n      })]\n    })]\n  });\n}\nfunction EmbedModal(props) {\n  const schema = serializeValue(props.schema);\n  const data = serializeValue(props.data || {});\n  const fieldRef = useRef();\n  const snippet = `<!-- styles needed for rendering -->\n<link rel=\"stylesheet\" href=\"https://unpkg.com/@bpmn-io/form-js@0.2.4/dist/assets/form-js.css\">\n\n<!-- container to render the form into -->\n<div class=\"fjs-pgl-form-container\"></div>\n\n<!-- scripts needed for embedding -->\n<script src=\"https://unpkg.com/@bpmn-io/form-js@0.2.4/dist/form-viewer.umd.js\"></script>\n\n<!-- actual script to instantiate the form and load form schema + data -->\n<script>\n  const data = JSON.parse(${data});\n  const schema = JSON.parse(${schema});\n\n  const form = new FormViewer.Form({\n    container: document.querySelector(\".fjs-pgl-form-container\")\n  });\n\n  form.on(\"submit\", (event) => {\n    console.log(event.data, event.errors);\n  });\n\n  form.importSchema(schema, data).catch(err => {\n    console.error(\"Failed to render form\", err);\n  });\n</script>\n  `.trim();\n  useEffect(() => {\n    fieldRef.current.select();\n  });\n  return jsxs(Modal, {\n    name: \"Embed form\",\n    onClose: props.onClose,\n    children: [jsxs(\"p\", {\n      children: [\"Use the following HTML snippet to embed your form with \", jsx(\"a\", {\n        href: \"https://github.com/bpmn-io/form-js\",\n        children: \"form-js\"\n      }), \":\"]\n    }), jsx(\"textarea\", {\n      spellCheck: \"false\",\n      ref: fieldRef,\n      children: snippet\n    })]\n  });\n}\n\n// helpers ///////////\n\nfunction serializeValue(obj) {\n  return JSON.stringify(JSON.stringify(obj)).replace(/</g, '&lt;').replace(/>/g, '&gt;');\n}\n\n/**\n * @type {Facet<import('..').Variables>} Variables\n */\nconst variablesFacet = Facet.define();\nfunction autocompletionExtension() {\n  return [autocompletion({\n    override: [completions]\n  })];\n}\nfunction completions(context) {\n  const variables = context.state.facet(variablesFacet)[0];\n  const options = variables.map(v => ({\n    label: v,\n    type: 'variable'\n  }));\n  let nodeBefore = syntaxTree(context.state).resolve(context.pos, -1);\n\n  // handle inside property name as explicit call\n  if (nodeBefore.type.name === 'PropertyName') {\n    context.explicit = true;\n  }\n  let word = context.matchBefore(/\\w*/);\n  if (word.from == word.to && !context.explicit) {\n    return null;\n  }\n  return {\n    from: word.from,\n    options\n  };\n}\nconst NO_LINT_CLS = 'fjs-no-json-lint';\n\n/**\n * @param {object} options\n * @param {boolean} [options.readonly]\n * @param {object} [options.contentAttributes]\n * @param {string | HTMLElement} [options.placeholder]\n */\nfunction JSONEditor(options = {}) {\n  const {\n    contentAttributes = {},\n    placeholder: editorPlaceholder,\n    readonly = false\n  } = options;\n  const emitter = mitt();\n  let language = new Compartment().of(json());\n  let tabSize = new Compartment().of(EditorState.tabSize.of(2));\n  let container = null;\n\n  /**\n   * @typedef {Array<string>} Variables\n   */\n\n  const autocompletionConf = new Compartment();\n  const linterExtension = linter(jsonParseLinter());\n\n  // this sets no-linting mode if placeholders are present\n  const placeholderLinterExtension = linter(view => {\n    const placeholders = view.dom.querySelectorAll('.cm-placeholder');\n    if (placeholders.length > 0) {\n      set(container, NO_LINT_CLS);\n    } else {\n      unset(container, NO_LINT_CLS);\n    }\n    return [];\n  });\n  function createState(doc, extensions = [], variables = []) {\n    return EditorState.create({\n      doc,\n      extensions: [basicSetup, language, tabSize, linterExtension, placeholderLinterExtension, lintGutter(), autocompletionConf.of(variablesFacet.of(variables)), autocompletionExtension(), keymap.of([indentWithTab]), editorPlaceholder ? placeholder(editorPlaceholder) : [], ...extensions]\n    });\n  }\n  function createView(readonly) {\n    const updateListener = EditorView.updateListener.of(update => {\n      if (update.docChanged) {\n        emitter.emit('changed', {\n          value: update.view.state.doc.toString()\n        });\n      }\n    });\n    const editable = EditorView.editable.of(!readonly);\n    const contentAttributesExtension = EditorView.contentAttributes.of(contentAttributes);\n    const view = new EditorView({\n      state: createState('', [updateListener, editable, contentAttributesExtension])\n    });\n    view.setValue = function (value) {\n      this.setState(createState(value, [updateListener, editable, contentAttributesExtension]));\n    };\n    view.setVariables = function (variables) {\n      this.setState(createState(view.state.doc.toString(), [updateListener, editable, contentAttributesExtension], variables));\n    };\n    return view;\n  }\n  const view = this._view = createView(readonly);\n  this.setValue = function (value) {\n    view.setValue(value);\n  };\n  this.getValue = function () {\n    return view.state.doc.toString();\n  };\n\n  /**\n   * @param {Variables} variables\n   */\n  this.setVariables = function (variables) {\n    view.setVariables(variables);\n  };\n  this.on = emitter.on;\n  this.off = emitter.off;\n  this.emit = emitter.emit;\n  this.attachTo = function (_container) {\n    container = _container;\n    container.appendChild(view.dom);\n  };\n  this.destroy = function () {\n    if (view.dom.parentNode) {\n      view.dom.parentNode.removeChild(view.dom);\n    }\n    view.destroy();\n  };\n}\n\n// helpers //////////////////////\n\nfunction set(node, cls) {\n  const classes$1 = classes(node, document.body);\n  classes$1.add(cls);\n}\nfunction unset(node, cls) {\n  const classes$1 = classes(node, document.body);\n  classes$1.remove(cls);\n}\nfunction Section(props) {\n  const elements = Array.isArray(props.children) ? props.children : [props.children];\n  const {\n    headerItems,\n    children\n  } = elements.reduce((_, child) => {\n    const bucket = child.type === Section.HeaderItem ? _.headerItems : _.children;\n    bucket.push(child);\n    return _;\n  }, {\n    headerItems: [],\n    children: []\n  });\n  return jsxs(\"div\", {\n    class: \"fjs-pgl-section\",\n    children: [jsxs(\"h1\", {\n      class: \"header\",\n      children: [props.name, \" \", headerItems.length ? jsx(\"span\", {\n        class: \"header-items\",\n        children: headerItems\n      }) : null]\n    }), jsx(\"div\", {\n      class: \"body\",\n      children: children\n    })]\n  });\n}\nSection.HeaderItem = function (props) {\n  return props.children;\n};\nfunction PlaygroundRoot(props) {\n  const {\n    additionalModules = [],\n    // goes into both editor + viewer\n    actions: actionsConfig = {},\n    emit,\n    exporter: exporterConfig = {},\n    viewerProperties = {},\n    editorProperties = {},\n    viewerAdditionalModules = [],\n    editorAdditionalModules = [],\n    propertiesPanel: propertiesPanelConfig = {},\n    onInit: onPlaygroundInit,\n    onStateChanged\n  } = props;\n  const {\n    display: displayActions = true\n  } = actionsConfig;\n  const paletteContainerRef = useRef();\n  const editorContainerRef = useRef();\n  const formContainerRef = useRef();\n  const dataContainerRef = useRef();\n  const resultContainerRef = useRef();\n  const propertiesPanelContainerRef = useRef();\n  const paletteRef = useRef();\n  const formEditorRef = useRef();\n  const formRef = useRef();\n  const dataEditorRef = useRef();\n  const resultViewRef = useRef();\n  const propertiesPanelRef = useRef();\n  const [showEmbed, setShowEmbed] = useState(false);\n  const [initialData] = useState(props.data || undefined);\n  const [initialSchema, setInitialSchema] = useState(props.schema);\n  const [data, setData] = useState(props.data || {});\n  const [schema, setSchema] = useState(props.schema);\n  const [resultData, setResultData] = useState({});\n\n  // pipe to playground API\n  useEffect(() => {\n    onPlaygroundInit({\n      attachDataContainer: node => dataEditorRef.current.attachTo(node),\n      attachEditorContainer: node => formEditorRef.current.attachTo(node),\n      attachFormContainer: node => formRef.current.attachTo(node),\n      attachPaletteContainer: node => paletteRef.current.attachTo(node),\n      attachPropertiesPanelContainer: node => propertiesPanelRef.current.attachTo(node),\n      attachResultContainer: node => resultViewRef.current.attachTo(node),\n      get: (name, strict) => formEditorRef.current.get(name, strict),\n      getDataEditor: () => dataEditorRef.current,\n      getEditor: () => formEditorRef.current,\n      getForm: () => formRef.current,\n      getResultView: () => resultViewRef.current,\n      getSchema: () => formEditorRef.current.getSchema(),\n      setSchema: setInitialSchema,\n      saveSchema: () => formEditorRef.current.saveSchema()\n    });\n  }, [onPlaygroundInit]);\n  useEffect(() => {\n    setInitialSchema(props.schema || {});\n  }, [props.schema]);\n  useEffect(() => {\n    const dataEditor = dataEditorRef.current = new JSONEditor({\n      value: toString(data),\n      contentAttributes: {\n        'aria-label': 'Form Input',\n        tabIndex: 0\n      },\n      placeholder: createDataEditorPlaceholder()\n    });\n    const resultView = resultViewRef.current = new JSONEditor({\n      readonly: true,\n      value: toString(resultData),\n      contentAttributes: {\n        'aria-label': 'Form Output',\n        tabIndex: 0\n      }\n    });\n    const form = formRef.current = new Form({\n      additionalModules: [...additionalModules, ...viewerAdditionalModules],\n      properties: {\n        ...viewerProperties,\n        'ariaLabel': 'Form Preview'\n      }\n    });\n    const formEditor = formEditorRef.current = new FormEditor({\n      renderer: {\n        compact: true\n      },\n      palette: {\n        parent: paletteContainerRef.current\n      },\n      propertiesPanel: {\n        parent: propertiesPanelContainerRef.current,\n        ...propertiesPanelConfig\n      },\n      exporter: exporterConfig,\n      properties: {\n        ...editorProperties,\n        'ariaLabel': 'Form Definition'\n      },\n      additionalModules: [...additionalModules, ...editorAdditionalModules]\n    });\n    paletteRef.current = formEditor.get('palette');\n    propertiesPanelRef.current = formEditor.get('propertiesPanel');\n    formEditor.on('formField.add', ({\n      formField\n    }) => {\n      const formFields = formEditor.get('formFields');\n      const {\n        config\n      } = formFields.get(formField.type);\n      const {\n        generateInitialDemoData\n      } = config;\n      const {\n        id\n      } = formField;\n      if (!isFunction(generateInitialDemoData)) {\n        return;\n      }\n      const initialDemoData = generateInitialDemoData(formField);\n      if ([initialDemoData, id].includes(undefined)) {\n        return;\n      }\n      setData(currentData => {\n        const newData = {\n          ...currentData,\n          [id]: initialDemoData\n        };\n        dataEditorRef.current.setValue(toString(newData));\n        return newData;\n      });\n    });\n    formEditor.on('changed', () => {\n      setSchema(formEditor.getSchema());\n    });\n    formEditor.on('formEditor.rendered', () => {\n      // notify interested parties after render\n      emit('formPlayground.rendered');\n    });\n    form.on('changed', () => {\n      setResultData(form._getSubmitData());\n    });\n    dataEditor.on('changed', event => {\n      try {\n        setData(JSON.parse(event.value));\n      } catch (error) {\n        // notify interested about input data error\n        emit('formPlayground.inputDataError', error);\n      }\n    });\n    const formContainer = formContainerRef.current;\n    const editorContainer = editorContainerRef.current;\n    const dataContainer = dataContainerRef.current;\n    const resultContainer = resultContainerRef.current;\n    dataEditor.attachTo(dataContainer);\n    resultView.attachTo(resultContainer);\n    form.attachTo(formContainer);\n    formEditor.attachTo(editorContainer);\n    return () => {\n      dataEditor.destroy();\n      resultView.destroy();\n      form.destroy();\n      formEditor.destroy();\n    };\n  }, []);\n  useEffect(() => {\n    dataEditorRef.current.setValue(toString(initialData));\n  }, [initialData]);\n  useEffect(() => {\n    if (initialSchema) {\n      formEditorRef.current.importSchema(initialSchema);\n      dataEditorRef.current.setVariables(getSchemaVariables(initialSchema));\n    }\n  }, [initialSchema]);\n  useEffect(() => {\n    if (schema && dataContainerRef.current) {\n      const variables = getSchemaVariables(schema);\n      dataEditorRef.current.setVariables(variables);\n    }\n  }, [schema]);\n  useEffect(() => {\n    schema && formRef.current.importSchema(schema, data);\n  }, [schema, data]);\n  useEffect(() => {\n    resultViewRef.current.setValue(toString(resultData));\n  }, [resultData]);\n  useEffect(() => {\n    onStateChanged && onStateChanged({\n      schema,\n      data\n    });\n  }, [onStateChanged, schema, data]);\n  const handleDownload = useCallback(() => {\n    download(JSON.stringify(schema, null, '  '), 'form.json', 'text/json');\n  }, [schema]);\n  const hideEmbedModal = useCallback(() => {\n    setShowEmbed(false);\n  }, []);\n  const showEmbedModal = useCallback(() => {\n    setShowEmbed(true);\n  }, []);\n  return jsxs(\"div\", {\n    class: classNames('fjs-container', 'fjs-pgl-root'),\n    children: [jsx(\"div\", {\n      class: \"fjs-pgl-modals\",\n      children: showEmbed ? jsx(EmbedModal, {\n        schema: schema,\n        data: data,\n        onClose: hideEmbedModal\n      }) : null\n    }), jsx(\"div\", {\n      class: \"fjs-pgl-palette-container\",\n      ref: paletteContainerRef\n    }), jsxs(\"div\", {\n      class: \"fjs-pgl-main\",\n      children: [jsxs(Section, {\n        name: \"Form Definition\",\n        children: [displayActions && jsx(Section.HeaderItem, {\n          children: jsx(\"button\", {\n            type: \"button\",\n            class: \"fjs-pgl-button\",\n            title: \"Download form definition\",\n            onClick: handleDownload,\n            children: \"Download\"\n          })\n        }), displayActions && jsx(Section.HeaderItem, {\n          children: jsx(\"button\", {\n            type: \"button\",\n            class: \"fjs-pgl-button\",\n            onClick: showEmbedModal,\n            children: \"Embed\"\n          })\n        }), jsx(\"div\", {\n          ref: editorContainerRef,\n          class: \"fjs-pgl-form-container\"\n        })]\n      }), jsx(Section, {\n        name: \"Form Preview\",\n        children: jsx(\"div\", {\n          ref: formContainerRef,\n          class: \"fjs-pgl-form-container\"\n        })\n      }), jsx(Section, {\n        name: \"Form Input\",\n        children: jsx(\"div\", {\n          ref: dataContainerRef,\n          class: \"fjs-pgl-text-container\"\n        })\n      }), jsx(Section, {\n        name: \"Form Output\",\n        children: jsx(\"div\", {\n          ref: resultContainerRef,\n          class: \"fjs-pgl-text-container\"\n        })\n      })]\n    }), jsx(\"div\", {\n      class: \"fjs-pgl-properties-container\",\n      ref: propertiesPanelContainerRef\n    })]\n  });\n}\n\n// helpers ///////////////\n\nfunction toString(obj) {\n  return JSON.stringify(obj, null, '  ');\n}\nfunction createDataEditorPlaceholder() {\n  const element = document.createElement('p');\n  element.innerHTML = 'Use this panel to simulate the form input, such as process variables.\\nThis helps to test the form by populating the preview.\\n\\n' + 'Follow the JSON format like this:\\n\\n' + '{\\n  \"variable\": \"value\"\\n}';\n  return element;\n}\nfunction Playground(options) {\n  const {\n    container: parent,\n    schema,\n    data,\n    ...rest\n  } = options;\n  const emitter = mitt();\n  let state = {\n    data,\n    schema\n  };\n  let ref;\n  const container = document.createElement('div');\n  container.classList.add('fjs-pgl-parent');\n  if (parent) {\n    parent.appendChild(container);\n  }\n  const handleDrop = fileDrop('Drop a form file', function (files) {\n    const file = files[0];\n    if (file) {\n      try {\n        ref.setSchema(JSON.parse(file.contents));\n      } catch (err) {\n\n        // TODO(nikku): indicate JSON parse error\n      }\n    }\n  });\n  const withRef = function (fn) {\n    return function (...args) {\n      if (!ref) {\n        throw new Error('Playground is not initialized.');\n      }\n      return fn(...args);\n    };\n  };\n  const onInit = function (_ref) {\n    ref = _ref;\n    emitter.emit('formPlayground.init');\n  };\n  container.addEventListener('dragover', handleDrop);\n  render(jsx(PlaygroundRoot, {\n    data: data,\n    emit: emitter.emit,\n    onInit: onInit,\n    onStateChanged: _state => state = _state,\n    schema: schema,\n    ...rest\n  }), container);\n  this.on = emitter.on;\n  this.off = emitter.off;\n  this.emit = emitter.emit;\n  this.on('destroy', function () {\n    render(null, container);\n  });\n  this.on('destroy', function () {\n    parent.removeChild(container);\n  });\n  this.getState = function () {\n    return state;\n  };\n  this.getSchema = withRef(() => ref.getSchema());\n  this.setSchema = withRef(schema => ref.setSchema(schema));\n  this.saveSchema = withRef(() => ref.saveSchema());\n  this.get = withRef((name, strict) => ref.get(name, strict));\n  this.getDataEditor = withRef(() => ref.getDataEditor());\n  this.getEditor = withRef(() => ref.getEditor());\n  this.getForm = withRef((name, strict) => ref.getForm(name, strict));\n  this.getResultView = withRef(() => ref.getResultView());\n  this.destroy = function () {\n    this.emit('destroy');\n  };\n  this.attachEditorContainer = withRef(node => ref.attachEditorContainer(node));\n  this.attachPreviewContainer = withRef(node => ref.attachFormContainer(node));\n  this.attachDataContainer = withRef(node => ref.attachDataContainer(node));\n  this.attachResultContainer = withRef(node => ref.attachResultContainer(node));\n  this.attachPaletteContainer = withRef(node => ref.attachPaletteContainer(node));\n  this.attachPropertiesPanelContainer = withRef(node => ref.attachPropertiesPanelContainer(node));\n}\nexport { Playground };","map":{"version":3,"names":["Modal","props","useEffect","handleKey","event","key","stopPropagation","onClose","document","addEventListener","removeEventListener","jsxs","class","children","jsx","onClick","name","type","EmbedModal","schema","serializeValue","data","fieldRef","useRef","snippet","trim","current","select","href","spellCheck","ref","obj","JSON","stringify","replace","variablesFacet","Facet","define","autocompletionExtension","autocompletion","override","completions","context","variables","state","facet","options","map","v","label","nodeBefore","syntaxTree","resolve","pos","explicit","word","matchBefore","from","to","NO_LINT_CLS","JSONEditor","contentAttributes","placeholder","editorPlaceholder","readonly","emitter","mitt","language","Compartment","of","json","tabSize","EditorState","container","autocompletionConf","linterExtension","linter","jsonParseLinter","placeholderLinterExtension","view","placeholders","dom","querySelectorAll","length","set","unset","createState","doc","extensions","create","basicSetup","lintGutter","keymap","indentWithTab","createView","updateListener","EditorView","update","docChanged","emit","value","toString","editable","contentAttributesExtension","setValue","setState","setVariables","_view","getValue","on","off","attachTo","_container","appendChild","destroy","parentNode","removeChild","node","cls","classes$1","classes","body","add","remove","Section","elements","Array","isArray","headerItems","reduce","_","child","bucket","HeaderItem","push","PlaygroundRoot","additionalModules","actions","actionsConfig","exporter","exporterConfig","viewerProperties","editorProperties","viewerAdditionalModules","editorAdditionalModules","propertiesPanel","propertiesPanelConfig","onInit","onPlaygroundInit","onStateChanged","display","displayActions","paletteContainerRef","editorContainerRef","formContainerRef","dataContainerRef","resultContainerRef","propertiesPanelContainerRef","paletteRef","formEditorRef","formRef","dataEditorRef","resultViewRef","propertiesPanelRef","showEmbed","setShowEmbed","useState","initialData","undefined","initialSchema","setInitialSchema","setData","setSchema","resultData","setResultData","attachDataContainer","attachEditorContainer","attachFormContainer","attachPaletteContainer","attachPropertiesPanelContainer","attachResultContainer","get","strict","getDataEditor","getEditor","getForm","getResultView","getSchema","saveSchema","dataEditor","tabIndex","createDataEditorPlaceholder","resultView","form","Form","properties","formEditor","FormEditor","renderer","compact","palette","parent","formField","formFields","config","generateInitialDemoData","id","isFunction","initialDemoData","includes","currentData","newData","_getSubmitData","parse","error","formContainer","editorContainer","dataContainer","resultContainer","importSchema","getSchemaVariables","handleDownload","useCallback","download","hideEmbedModal","showEmbedModal","classNames","title","element","createElement","innerHTML","Playground","rest","classList","handleDrop","fileDrop","files","file","contents","err","withRef","fn","args","Error","_ref","render","_state","getState","attachPreviewContainer"],"sources":["/Users/Shivaji/Workspace/Play/cta/node_modules/@bpmn-io/form-js-playground/src/components/Modal.js","/Users/Shivaji/Workspace/Play/cta/node_modules/@bpmn-io/form-js-playground/src/components/EmbedModal.js","/Users/Shivaji/Workspace/Play/cta/node_modules/@bpmn-io/form-js-playground/src/components/autocompletion/VariablesFacet.js","/Users/Shivaji/Workspace/Play/cta/node_modules/@bpmn-io/form-js-playground/src/components/autocompletion/index.js","/Users/Shivaji/Workspace/Play/cta/node_modules/@bpmn-io/form-js-playground/src/components/JSONEditor.js","/Users/Shivaji/Workspace/Play/cta/node_modules/@bpmn-io/form-js-playground/src/components/Section.js","/Users/Shivaji/Workspace/Play/cta/node_modules/@bpmn-io/form-js-playground/src/components/PlaygroundRoot.js","/Users/Shivaji/Workspace/Play/cta/node_modules/@bpmn-io/form-js-playground/src/Playground.js"],"sourcesContent":["import { useEffect } from 'preact/hooks';\n\nexport function Modal(props) {\n\n  useEffect(() => {\n    function handleKey(event) {\n\n      if (event.key === 'Escape') {\n        event.stopPropagation();\n\n        props.onClose();\n      }\n    }\n\n    document.addEventListener('keydown', handleKey);\n\n    return () => {\n      document.removeEventListener('keydown', handleKey);\n    };\n  });\n\n  return (\n    <div class=\"fjs-pgl-modal\">\n      <div class=\"fjs-pgl-modal-backdrop\" onClick={ props.onClose }></div>\n      <div class=\"fjs-pgl-modal-content\">\n        <h1 class=\"fjs-pgl-modal-header\">{ props.name }</h1>\n        <div class=\"fjs-pgl-modal-body\">\n          { props.children }\n        </div>\n        <div class=\"fjs-pgl-modal-footer\">\n          <button type=\"button\" class=\"fjs-pgl-button fjs-pgl-button-default\" onClick={ props.onClose }>Close</button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useEffect, useRef } from 'preact/hooks';\n\nimport { Modal } from './Modal';\n\n\nexport function EmbedModal(props) {\n\n  const schema = serializeValue(props.schema);\n  const data = serializeValue(props.data || {});\n\n  const fieldRef = useRef();\n\n  const snippet = `<!-- styles needed for rendering -->\n<link rel=\"stylesheet\" href=\"https://unpkg.com/@bpmn-io/form-js@0.2.4/dist/assets/form-js.css\">\n\n<!-- container to render the form into -->\n<div class=\"fjs-pgl-form-container\"></div>\n\n<!-- scripts needed for embedding -->\n<script src=\"https://unpkg.com/@bpmn-io/form-js@0.2.4/dist/form-viewer.umd.js\"></script>\n\n<!-- actual script to instantiate the form and load form schema + data -->\n<script>\n  const data = JSON.parse(${data});\n  const schema = JSON.parse(${schema});\n\n  const form = new FormViewer.Form({\n    container: document.querySelector(\".fjs-pgl-form-container\")\n  });\n\n  form.on(\"submit\", (event) => {\n    console.log(event.data, event.errors);\n  });\n\n  form.importSchema(schema, data).catch(err => {\n    console.error(\"Failed to render form\", err);\n  });\n</script>\n  `.trim();\n\n  useEffect(() => {\n    fieldRef.current.select();\n  });\n\n  return (\n    <Modal name=\"Embed form\" onClose={ props.onClose }>\n      <p>Use the following HTML snippet to embed your form with <a href=\"https://github.com/bpmn-io/form-js\">form-js</a>:</p>\n\n      <textarea spellCheck=\"false\" ref={ fieldRef }>{snippet}</textarea>\n    </Modal>\n  );\n}\n\n\n// helpers ///////////\n\nfunction serializeValue(obj) {\n  return JSON.stringify(JSON.stringify(obj)).replace(/</g, '&lt;').replace(/>/g, '&gt;');\n}","import { Facet } from '@codemirror/state';\n\n/**\n * @type {Facet<import('..').Variables>} Variables\n */\nexport const variablesFacet = Facet.define();","import { autocompletion } from '@codemirror/autocomplete';\nimport { variablesFacet } from './VariablesFacet';\n\nimport { syntaxTree } from '@codemirror/language';\n\nexport function autocompletionExtension() {\n  return [\n    autocompletion({\n      override: [\n        completions\n      ]\n    })\n  ];\n}\n\nfunction completions(context) {\n\n  const variables = context.state.facet(variablesFacet)[0];\n\n  const options = variables.map(v => ({\n    label: v,\n    type: 'variable'\n  }));\n\n  let nodeBefore = syntaxTree(context.state).resolve(context.pos, -1);\n\n  // handle inside property name as explicit call\n  if (nodeBefore.type.name === 'PropertyName') {\n    context.explicit = true;\n  }\n\n  let word = context.matchBefore(/\\w*/);\n\n  if (word.from == word.to && !context.explicit) {\n    return null;\n  }\n\n  return {\n    from: word.from,\n    options\n  };\n}","import mitt from 'mitt';\n\nimport { basicSetup } from 'codemirror';\nimport { EditorView, keymap, placeholder } from '@codemirror/view';\nimport { EditorState, Compartment } from '@codemirror/state';\nimport { lintGutter, linter } from '@codemirror/lint';\nimport { json, jsonParseLinter } from '@codemirror/lang-json';\nimport { indentWithTab } from '@codemirror/commands';\nimport { autocompletionExtension } from './autocompletion/index';\nimport { variablesFacet } from './autocompletion/VariablesFacet';\n\nimport {\n  classes as domClasses\n} from 'min-dom';\n\nconst NO_LINT_CLS = 'fjs-no-json-lint';\n\n\n/**\n * @param {object} options\n * @param {boolean} [options.readonly]\n * @param {object} [options.contentAttributes]\n * @param {string | HTMLElement} [options.placeholder]\n */\nexport function JSONEditor(options = {}) {\n  const {\n    contentAttributes = {},\n    placeholder: editorPlaceholder,\n    readonly = false,\n  } = options;\n\n  const emitter = mitt();\n\n  let language = new Compartment().of(json());\n  let tabSize = new Compartment().of(EditorState.tabSize.of(2));\n\n  let container = null;\n\n\n  /**\n   * @typedef {Array<string>} Variables\n   */\n\n  const autocompletionConf = new Compartment();\n\n  const linterExtension = linter(jsonParseLinter());\n\n  // this sets no-linting mode if placeholders are present\n  const placeholderLinterExtension = linter(view => {\n    const placeholders = view.dom.querySelectorAll('.cm-placeholder');\n\n    if (placeholders.length > 0) {\n      set(container, NO_LINT_CLS);\n    } else {\n      unset(container, NO_LINT_CLS);\n    }\n\n    return [];\n  });\n\n  function createState(doc, extensions = [], variables = []) {\n    return EditorState.create({\n      doc,\n      extensions: [\n        basicSetup,\n        language,\n        tabSize,\n        linterExtension,\n        placeholderLinterExtension,\n        lintGutter(),\n        autocompletionConf.of(variablesFacet.of(variables)),\n        autocompletionExtension(),\n        keymap.of([ indentWithTab ]),\n        editorPlaceholder ? placeholder(editorPlaceholder) : [],\n        ...extensions\n      ]\n    });\n  }\n\n  function createView(readonly) {\n\n    const updateListener = EditorView.updateListener.of(update => {\n      if (update.docChanged) {\n        emitter.emit('changed', {\n          value: update.view.state.doc.toString()\n        });\n      }\n    });\n\n    const editable = EditorView.editable.of(!readonly);\n\n    const contentAttributesExtension = EditorView.contentAttributes.of(contentAttributes);\n\n    const view = new EditorView({\n      state: createState('', [ updateListener, editable, contentAttributesExtension ])\n    });\n\n    view.setValue = function(value) {\n      this.setState(createState(value, [ updateListener, editable, contentAttributesExtension ]));\n    };\n\n    view.setVariables = function(variables) {\n      this.setState(createState(\n        view.state.doc.toString(),\n        [ updateListener, editable, contentAttributesExtension ],\n        variables\n      ));\n    };\n\n    return view;\n  }\n\n  const view = this._view = createView(readonly);\n\n  this.setValue = function(value) {\n    view.setValue(value);\n  };\n\n  this.getValue = function() {\n    return view.state.doc.toString();\n  };\n\n  /**\n   * @param {Variables} variables\n   */\n  this.setVariables = function(variables) {\n    view.setVariables(variables);\n  };\n\n  this.on = emitter.on;\n  this.off = emitter.off;\n  this.emit = emitter.emit;\n\n  this.attachTo = function(_container) {\n    container = _container;\n    container.appendChild(view.dom);\n  };\n\n  this.destroy = function() {\n    if (view.dom.parentNode) {\n      view.dom.parentNode.removeChild(view.dom);\n    }\n\n    view.destroy();\n  };\n}\n\n// helpers //////////////////////\n\n\nfunction set(node, cls) {\n  const classes = domClasses(node, document.body);\n  classes.add(cls);\n}\n\nfunction unset(node, cls) {\n  const classes = domClasses(node, document.body);\n  classes.remove(cls);\n}\n","export function Section(props) {\n\n  const elements =\n    Array.isArray(props.children)\n      ? props.children :\n      [ props.children ];\n\n  const {\n    headerItems,\n    children\n  } = elements.reduce((_, child) => {\n    const bucket =\n      child.type === Section.HeaderItem\n        ? _.headerItems\n        : _.children;\n\n    bucket.push(child);\n\n    return _;\n  }, { headerItems: [], children: [] });\n\n  return (\n    <div class=\"fjs-pgl-section\">\n      <h1 class=\"header\">{ props.name } { headerItems.length ? <span class=\"header-items\">{ headerItems }</span> : null }</h1>\n      <div class=\"body\">\n        { children }\n      </div>\n    </div>\n  );\n}\n\nSection.HeaderItem = function(props) {\n  return props.children;\n};","import { useRef, useEffect, useState, useCallback } from 'preact/hooks';\nimport { isFunction } from 'min-dash';\nimport download from 'downloadjs';\n\nimport classNames from 'classnames';\n\nimport {\n  Form,\n  getSchemaVariables\n} from '@bpmn-io/form-js-viewer';\n\nimport {\n  FormEditor\n} from '@bpmn-io/form-js-editor';\n\nimport { EmbedModal } from './EmbedModal';\nimport { JSONEditor } from './JSONEditor';\nimport { Section } from './Section';\n\n\nimport './FileDrop.css';\nimport './PlaygroundRoot.css';\n\n\nexport function PlaygroundRoot(props) {\n\n  const {\n    additionalModules = [], // goes into both editor + viewer\n    actions: actionsConfig = {},\n    emit,\n    exporter: exporterConfig = {},\n    viewerProperties = {},\n    editorProperties = {},\n    viewerAdditionalModules = [],\n    editorAdditionalModules = [],\n    propertiesPanel: propertiesPanelConfig = {},\n    onInit: onPlaygroundInit,\n    onStateChanged\n  } = props;\n\n  const {\n    display: displayActions = true\n  } = actionsConfig;\n\n  const paletteContainerRef = useRef();\n  const editorContainerRef = useRef();\n  const formContainerRef = useRef();\n  const dataContainerRef = useRef();\n  const resultContainerRef = useRef();\n  const propertiesPanelContainerRef = useRef();\n\n  const paletteRef = useRef();\n  const formEditorRef = useRef();\n  const formRef = useRef();\n  const dataEditorRef = useRef();\n  const resultViewRef = useRef();\n  const propertiesPanelRef = useRef();\n\n  const [ showEmbed, setShowEmbed ] = useState(false);\n\n  const [ initialData ] = useState(props.data || undefined);\n  const [ initialSchema, setInitialSchema ] = useState(props.schema);\n\n  const [ data, setData ] = useState(props.data || {});\n  const [ schema, setSchema ] = useState(props.schema);\n\n  const [ resultData, setResultData ] = useState({});\n\n  // pipe to playground API\n  useEffect(() => {\n    onPlaygroundInit({\n      attachDataContainer: (node) => dataEditorRef.current.attachTo(node),\n      attachEditorContainer: (node) => formEditorRef.current.attachTo(node),\n      attachFormContainer: (node) => formRef.current.attachTo(node),\n      attachPaletteContainer: (node) => paletteRef.current.attachTo(node),\n      attachPropertiesPanelContainer: (node) => propertiesPanelRef.current.attachTo(node),\n      attachResultContainer: (node) => resultViewRef.current.attachTo(node),\n      get: (name, strict) => formEditorRef.current.get(name, strict),\n      getDataEditor: () => dataEditorRef.current,\n      getEditor: () => formEditorRef.current,\n      getForm: () => formRef.current,\n      getResultView: () => resultViewRef.current,\n      getSchema: () => formEditorRef.current.getSchema(),\n      setSchema: setInitialSchema,\n      saveSchema: () => formEditorRef.current.saveSchema()\n    });\n  }, [ onPlaygroundInit ]);\n\n  useEffect(() => {\n    setInitialSchema(props.schema || {});\n  }, [ props.schema ]);\n\n  useEffect(() => {\n    const dataEditor = dataEditorRef.current = new JSONEditor({\n      value: toString(data),\n      contentAttributes: { 'aria-label': 'Form Input', tabIndex: 0 },\n      placeholder: createDataEditorPlaceholder()\n    });\n\n    const resultView = resultViewRef.current = new JSONEditor({\n      readonly: true,\n      value: toString(resultData),\n      contentAttributes: { 'aria-label': 'Form Output', tabIndex: 0 }\n    });\n\n    const form = formRef.current = new Form({\n      additionalModules: [\n        ...additionalModules,\n        ...viewerAdditionalModules\n      ],\n      properties: {\n        ...viewerProperties,\n        'ariaLabel': 'Form Preview'\n      }\n    });\n\n    const formEditor = formEditorRef.current = new FormEditor({\n      renderer: {\n        compact: true\n      },\n      palette: {\n        parent: paletteContainerRef.current\n      },\n      propertiesPanel: {\n        parent: propertiesPanelContainerRef.current,\n        ...propertiesPanelConfig\n      },\n      exporter: exporterConfig,\n      properties: {\n        ...editorProperties,\n        'ariaLabel': 'Form Definition'\n      },\n      additionalModules: [\n        ...additionalModules,\n        ...editorAdditionalModules\n      ]\n    });\n\n    paletteRef.current = formEditor.get('palette');\n    propertiesPanelRef.current = formEditor.get('propertiesPanel');\n\n    formEditor.on('formField.add', ({ formField }) => {\n      const formFields = formEditor.get('formFields');\n      const { config } = formFields.get(formField.type);\n      const { generateInitialDemoData } = config;\n      const { id } = formField;\n\n      if (!isFunction(generateInitialDemoData)) {\n        return;\n      }\n\n      const initialDemoData = generateInitialDemoData(formField);\n\n      if ([ initialDemoData, id ].includes(undefined)) {\n        return;\n      }\n\n      setData((currentData) => {\n        const newData = {\n          ...currentData,\n          [id]: initialDemoData,\n        };\n\n        dataEditorRef.current.setValue(\n          toString(newData)\n        );\n\n        return newData;\n      });\n    });\n\n    formEditor.on('changed', () => {\n      setSchema(formEditor.getSchema());\n    });\n\n    formEditor.on('formEditor.rendered', () => {\n\n      // notify interested parties after render\n      emit('formPlayground.rendered');\n    });\n\n    form.on('changed', () => {\n      setResultData(form._getSubmitData());\n    });\n\n    dataEditor.on('changed', event => {\n      try {\n        setData(JSON.parse(event.value));\n      } catch (error) {\n\n        // notify interested about input data error\n        emit('formPlayground.inputDataError', error);\n      }\n    });\n\n    const formContainer = formContainerRef.current;\n    const editorContainer = editorContainerRef.current;\n    const dataContainer = dataContainerRef.current;\n    const resultContainer = resultContainerRef.current;\n\n    dataEditor.attachTo(dataContainer);\n    resultView.attachTo(resultContainer);\n    form.attachTo(formContainer);\n    formEditor.attachTo(editorContainer);\n\n    return () => {\n      dataEditor.destroy();\n      resultView.destroy();\n      form.destroy();\n      formEditor.destroy();\n    };\n  }, []);\n\n  useEffect(() => {\n    dataEditorRef.current.setValue(toString(initialData));\n  }, [ initialData ]);\n\n  useEffect(() => {\n    if (initialSchema) {\n      formEditorRef.current.importSchema(initialSchema);\n      dataEditorRef.current.setVariables(getSchemaVariables(initialSchema));\n    }\n  }, [ initialSchema ]);\n\n  useEffect(() => {\n    if (schema && dataContainerRef.current) {\n      const variables = getSchemaVariables(schema);\n      dataEditorRef.current.setVariables(variables);\n    }\n  }, [ schema ]);\n\n  useEffect(() => {\n    schema && formRef.current.importSchema(schema, data);\n  }, [ schema, data ]);\n\n  useEffect(() => {\n    resultViewRef.current.setValue(toString(resultData));\n  }, [ resultData ]);\n\n  useEffect(() => {\n    onStateChanged && onStateChanged({\n      schema,\n      data\n    });\n  }, [ onStateChanged, schema, data ]);\n\n  const handleDownload = useCallback(() => {\n\n    download(JSON.stringify(schema, null, '  '), 'form.json', 'text/json');\n  }, [ schema ]);\n\n  const hideEmbedModal = useCallback(() => {\n    setShowEmbed(false);\n  }, []);\n\n  const showEmbedModal = useCallback(() => {\n    setShowEmbed(true);\n  }, []);\n\n  return (\n    <div class={ classNames(\n      'fjs-container',\n      'fjs-pgl-root'\n    ) }>\n      <div class=\"fjs-pgl-modals\">\n        { showEmbed ? <EmbedModal schema={ schema } data={ data } onClose={ hideEmbedModal } /> : null }\n      </div>\n      <div class=\"fjs-pgl-palette-container\" ref={ paletteContainerRef } />\n      <div class=\"fjs-pgl-main\">\n\n        <Section name=\"Form Definition\">\n\n          {\n            displayActions && <Section.HeaderItem>\n              <button\n                type=\"button\"\n                class=\"fjs-pgl-button\"\n                title=\"Download form definition\"\n                onClick={ handleDownload }\n              >Download</button>\n            </Section.HeaderItem>\n          }\n\n          {\n            displayActions && <Section.HeaderItem>\n              <button\n                type=\"button\"\n                class=\"fjs-pgl-button\"\n                onClick={ showEmbedModal }\n              >Embed</button>\n            </Section.HeaderItem>\n          }\n\n          <div ref={ editorContainerRef } class=\"fjs-pgl-form-container\"></div>\n        </Section>\n        <Section name=\"Form Preview\">\n          <div ref={ formContainerRef } class=\"fjs-pgl-form-container\"></div>\n        </Section>\n        <Section name=\"Form Input\">\n          <div ref={ dataContainerRef } class=\"fjs-pgl-text-container\"></div>\n        </Section>\n        <Section name=\"Form Output\">\n          <div ref={ resultContainerRef } class=\"fjs-pgl-text-container\"></div>\n        </Section>\n      </div>\n      <div class=\"fjs-pgl-properties-container\" ref={ propertiesPanelContainerRef } />\n    </div>\n  );\n}\n\n\n// helpers ///////////////\n\nfunction toString(obj) {\n  return JSON.stringify(obj, null, '  ');\n}\n\nfunction createDataEditorPlaceholder() {\n  const element = document.createElement('p');\n\n  element.innerHTML = 'Use this panel to simulate the form input, such as process variables.\\nThis helps to test the form by populating the preview.\\n\\n' +\n    'Follow the JSON format like this:\\n\\n' +\n    '{\\n  \"variable\": \"value\"\\n}';\n\n  return element;\n}","import { render } from 'preact';\n\nimport fileDrop from 'file-drops';\n\nimport mitt from 'mitt';\n\nimport { PlaygroundRoot } from './components/PlaygroundRoot';\n\n/**\n * @typedef { import('@bpmn-io/form-js-viewer/dist/types/types').FormProperties } FormProperties\n * @typedef { import('@bpmn-io/form-js-editor/dist/types/types').FormEditorProperties } FormEditorProperties\n *\n * @typedef { {\n *  actions?: { display: Boolean }\n *  additionalModules?: Array<any>\n *  container?: Element\n *  data: any\n *  editor?: { inlinePropertiesPanel: Boolean }\n *  editorAdditionalModules?: Array<any>\n *  editorProperties?: FormEditorProperties\n *  exporter?: { name: String, version: String }\n *  propertiesPanel?: { parent: Element, feelPopupContainer: Element }\n *  schema: any\n *  viewerAdditionalModules?: Array<any>\n *  viewerProperties?: FormProperties\n * } } FormPlaygroundOptions\n */\n\n/**\n * @param {FormPlaygroundOptions} options\n */\nexport function Playground(options) {\n\n  const {\n    container: parent,\n    schema,\n    data,\n    ...rest\n  } = options;\n\n  const emitter = mitt();\n\n  let state = { data, schema };\n  let ref;\n\n  const container = document.createElement('div');\n\n  container.classList.add('fjs-pgl-parent');\n\n  if (parent) {\n    parent.appendChild(container);\n  }\n\n  const handleDrop = fileDrop('Drop a form file', function(files) {\n    const file = files[0];\n\n    if (file) {\n      try {\n        ref.setSchema(JSON.parse(file.contents));\n      } catch (err) {\n\n        // TODO(nikku): indicate JSON parse error\n      }\n    }\n  });\n\n  const withRef = function(fn) {\n    return function(...args) {\n      if (!ref) {\n        throw new Error('Playground is not initialized.');\n      }\n\n      return fn(...args);\n    };\n  };\n\n  const onInit = function(_ref) {\n    ref = _ref;\n    emitter.emit('formPlayground.init');\n  };\n\n  container.addEventListener('dragover', handleDrop);\n\n  render(\n    <PlaygroundRoot\n      data={ data }\n      emit={ emitter.emit }\n      onInit={ onInit }\n      onStateChanged={ (_state) => state = _state }\n      schema={ schema }\n      { ...rest }\n    />,\n    container\n  );\n\n  this.on = emitter.on;\n  this.off = emitter.off;\n\n  this.emit = emitter.emit;\n\n  this.on('destroy', function() {\n    render(null, container);\n  });\n\n  this.on('destroy', function() {\n    parent.removeChild(container);\n  });\n\n  this.getState = function() {\n    return state;\n  };\n\n  this.getSchema = withRef(() => ref.getSchema());\n\n  this.setSchema = withRef((schema) => ref.setSchema(schema));\n\n  this.saveSchema = withRef(() => ref.saveSchema());\n\n  this.get = withRef((name, strict) => ref.get(name, strict));\n\n  this.getDataEditor = withRef(() => ref.getDataEditor());\n\n  this.getEditor = withRef(() => ref.getEditor());\n\n  this.getForm = withRef((name, strict) => ref.getForm(name, strict));\n\n  this.getResultView = withRef(() => ref.getResultView());\n\n  this.destroy = function() {\n    this.emit('destroy');\n  };\n\n  this.attachEditorContainer = withRef((node) => ref.attachEditorContainer(node));\n\n  this.attachPreviewContainer = withRef((node) => ref.attachFormContainer(node));\n\n  this.attachDataContainer = withRef((node) => ref.attachDataContainer(node));\n\n  this.attachResultContainer = withRef((node) => ref.attachResultContainer(node));\n\n  this.attachPaletteContainer = withRef((node) => ref.attachPaletteContainer(node));\n\n  this.attachPropertiesPanelContainer = withRef((node) => ref.attachPropertiesPanelContainer(node));\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}